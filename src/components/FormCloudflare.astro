---

---

<form id="my-form">
  <label>
    Name
    <input type="text" name="name" required />
  </label>
  <label>
    Email
    <input type="email" name="email" required />
  </label>
  <div
    class="cf-turnstile"
    data-sitekey={import.meta.env.SITE_KEY}
    data-size="invisible"
  >
  </div>
  <button type="submit">Submit</button>
</form>

<script>
  import { actions } from "astro:actions";

  const form = document.querySelector("#my-form") as HTMLFormElement;

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const { data, error } = await actions.submitForm(formData);

    // Always reset â€” token is single-use regardless of outcome
    turnstile.reset();

    if (error) {
      alert(error.message);
      return;
    }

    form.reset();
    alert("Form submitted successfully!");
  });
</script>
