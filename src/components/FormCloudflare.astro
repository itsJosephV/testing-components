---

---

<form id="my-form">
  <label>
    Name
    <input type="text" name="name" required />
  </label>
  <label>
    Email
    <input type="email" name="email" required />
  </label>
  <div
    class="cf-turnstile"
    data-sitekey={import.meta.env.PUBLIC_SITE_KEY}
    data-size="invisible"
  >
  </div>
  <button type="submit">Submit</button>
</form>

<script>
  import { actions } from "astro:actions";

  const form = document.querySelector("#my-form") as HTMLFormElement;
  const widget = document.querySelector(".cf-turnstile") as HTMLElement;

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const token = await turnstile.execute(widget, {});

    console.log(token);

    const formData = new FormData(form);
    formData.set("cf-turnstile-response", token);

    const { data, error } = await actions.submitForm(formData);

    turnstile.reset(widget);

    if (error) {
      alert(error.message);
      return;
    }

    form.reset();
    alert("Form submitted successfully!");
  });
</script>
